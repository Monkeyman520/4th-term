`CSAPP` -æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿå®éªŒæŠ¥å‘Š(`Bomblab`)

è¯¾ ç¨‹ å ç§°ï¼š     <u>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ</u>

å®éªŒé¡¹ç›®åç§°ï¼š<u>`BombLab`</u>

ä¸“ ä¸š ç­ çº§ï¼š     <u>è½¯ä»¶1902</u>     

å§“    åï¼š            <u>ä¾¯èŒ±å…ƒ</u>     

å­¦    å·ï¼š            <u>201926010214</u>

æŒ‡ å¯¼ æ•™ å¸ˆï¼š      <u>æ¨ç§‘å</u>

å®Œ æˆ æ—¶ é—´ï¼š      <u>2021 å¹´ 5 æœˆ 10 æ—¥</u>

## ç®€ä»‹ğŸ¨

`BombLab`æ˜¯`CS:APP`ä¸­å¯¹åº”ç¬¬ä¸‰ç« å†…å®¹ï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤ºçš„`lab`ã€‚ä¸»è¦å†…å®¹ä¸ºæä¾›ä¸€ä¸ªäºŒè¿›åˆ¶å¯¹è±¡æ–‡ä»¶ğŸ’£`bomb`ï¼Œå½“è¿è¡Œæ—¶ï¼Œå®ƒä¼šè¦æ±‚è¾“å…¥å…­ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœå…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸æ­£ç¡®ï¼Œç‚¸å¼¹å°±ä¼šçˆ†ç‚¸ï¼Œè¾“å‡ºä¸€è¡Œé”™è¯¯ä¿¡æ¯ï¼ˆä¸ä»£è¡¨æˆ‘ä»¬å¯ä»¥éšæ„è®©ç‚¸å¼¹çˆ†ç‚¸ï¼‰ï¼Œé€šè¿‡åæ±‡ç¼–å’Œé€†å‘å·¥ç¨‹æ¥æ‰¾åˆ°å…­ä¸ªæ­£ç¡®çš„å­—ç¬¦ä¸²æ¥è§£é™¤è‡ªå·±çš„ç‚¸å¼¹(æœ‰ä¸€ä¸ªéšè—ç‚¸å¼¹ğŸ¤­ï¼Œåç»­ä¼šä»‹ç»)ã€‚

æ ¹æ®è‡ªå·±å®Œæˆçš„ æ—¶é•¿å’Œå¤±è¯¯çš„æ¬¡æ•°æ¥çœ‹ï¼Œè¿˜éœ€è¦æ›´åŠ åŠªåŠ›(ğŸ˜”)ã€‚é­å—éäººçš„æŠ˜ç£¨åï¼Œé€‰æ‹©å°†æŠ¥å‘Šå†™çš„æ¬¢å¿«ä¸€ç‚¹ï¼Œè‹¥æœ‰ä¸åˆç†ä¹‹å¤„ï¼Œè¯·è”ç³»ğŸ‘¨â€ğŸ’»é„™äººè¿›è¡Œä¿®æ”¹ï¼Œå¤šè°¢å…³ç…§ğŸ˜­ã€‚

## æ‰€ç”¨å·¥å…·ğŸ› 

* `objdump`-ç”¨äºåæ±‡ç¼–äºŒè¿›åˆ¶å¯¹è±¡æ–‡ä»¶

* `VS Code`-ç”¨äºæŸ¥çœ‹åæ±‡ç¼–åçš„ç»“æœä¸æ–‡æœ¬æ–‡ä»¶çš„ç¼–å†™(æ­¤å¤„æ‰€ä½¿ç”¨çš„`Ubuntu`ç‰ˆæœ¬ä¸º`16.04 -i386` æœ€åçš„`Ubuntu` 32ä½å‘è¡Œç‰ˆï¼Œæ•…æ”¯æŒ`VS Code`)

* `gdb`-ç”¨äºè¿è¡Œæ—¶å•æ­¥è°ƒè¯•ä¸æŸ¥çœ‹è¿è¡Œæ—¶å†…å­˜ä¸å¯„å­˜å™¨ä¿¡æ¯

## è§£é¢˜è¿‡ç¨‹ğŸ§

### å¼€å§‹ğŸ™ƒ

ç”±äºä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡ç±»ä¼¼çš„é€†å‘å·¥ç¨‹é—®é¢˜ï¼Œæ‹¿åˆ°é—®é¢˜ä»¥åç¬¬ä¸€æ—¶é—´å¾ˆéš¾é©¬ä¸Šå¼€å§‹è§£å†³ã€‚æ‰€ä»¥å…ˆæŸ¥çœ‹æˆ‘ä»¬èƒ½çœ‹åˆ°çš„æ–‡ä»¶ä¿¡æ¯ã€‚

ç›®å½•ä¸­æä¾›äº†ä¸€ä¸ª`bomb.c`æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ååˆ†ç®€å•ï¼Œæœ‰ä¸€ä»½éå¸¸æœ‰è¶£çš„`LISENCE`:

> ```text
> /***
> 
> * Dr. Evilâ€™s Insidious Bomb, Version 1.1
> 
> * Copyright 2011, Dr. Evil Incorporated. All rights reserved.
> 
> *
> 
> * LICENSE:
> 
> *
> 
> * Dr. Evil Incorporated (the PERPETRATOR) hereby grants you (the
> 
> * VICTIM) explicit permission to use this bomb (the BOMB). This is a
> 
> * time limited license, which expires on the death of the VICTIM.
> 
> * The PERPETRATOR takes no responsibility for damage, frustration,
> 
> * insanity, bug-eyes, carpal-tunnel syndrome, loss of sleep, or other
> 
> * harm to the VICTIM. Unless the PERPETRATOR wants to take credit,
> 
> * that is. The VICTIM may not distribute this bomb source code to
> 
> * any enemies of the PERPETRATOR. No VICTIM may debug,
> 
> * reverse-engineer, run â€œstringsâ€ on, decompile, decrypt, or use any
> 
> * other technique to gain knowledge of and defuse the BOMB. BOMB
> 
> * proof clothing may not be worn when handling this program. The
> 
> * PERPETRATOR will not apologize for the PERPETRATORâ€™s poor sense of
> 
> * humor. This license is null and void where the BOMB is prohibited
> 
> * by law.
> 
> ***
> ```

æ¥ä¸‹æ¥çš„éƒ¨åˆ†å°±æ˜¯`main`å‡½æ•°ï¼Œä»ä¸»å‡½æ•°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªç¨‹åºçš„ç»“æ„ä¸è¾“å…¥æ–¹å¼ï¼šå¯ä»¥ä»æ ‡å‡†è¾“å…¥æˆ–æ–‡ä»¶ä¸­è¯»å–ï¼Œä¸€è¡Œä½œä¸ºä¸€é¢˜çš„è§£ï¼Œè§£å‡ºä¸€ä¸ªé—®é¢˜ä»¥åå¯ä»¥è¿›å…¥ä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œæ³¨æ„åˆ°è¿”å›å‰çš„ä¸€æ®µæ³¨é‡Šï¼š

> ```
> /* Wow, they got it! But isnâ€™t somethingâ€¦ missing? Perhaps
> 
>  * something they overlooked? Mua ha ha ha ha! */
> ```


æš—ç¤ºäº†æˆ‘ä»¬éšè—é—®é¢˜çš„å­˜åœ¨ï¼Œé™¤æ­¤ä¹‹å¤–å†ä¹Ÿæ²¡æœ‰ä»»ä½•å…³äºè¿™ä¸ªç‚¸å¼¹çš„ä¿¡æ¯ã€‚

ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨`objdump`å‘½ä»¤å°†ç‚¸å¼¹æ–‡ä»¶åæ±‡ç¼–å‡ºæ¥ï¼š

> ``` bash
> objdump -D bomb > bomb.s
> ```

ç„¶åé€šè¿‡`VS Code`æ¥æŸ¥çœ‹åæ±‡ç¼–çš„ç»“æœï¼Œ`VS Code`æœ‰`x86 and x86_64 Assembly`æ’ä»¶å¯ä»¥é«˜äº®æ±‡ç¼–ï¼Œçœ‹èµ·æ¥ä¼šèˆ’æœè®¸å¤šã€‚

åæ±‡ç¼–å‡ºæ¥çš„ä»£ç æœ‰è¿‘äº”åƒè¡ŒğŸ˜±ï¼Œä½†æ˜¯å› ä¸ºæœ‰ç¬¦å·è¡¨çš„å­˜åœ¨ï¼Œè¯´æ˜ä¿ç•™äº†è°ƒè¯•æ‰€éœ€çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`gdb`è¿›è¡Œå•æ­¥è°ƒè¯•æ¥æŸ¥çœ‹ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ã€‚

![image-20210514153131037](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514153139.png)

é€šè¿‡`bomb.c`å¯ä»¥çŸ¥é“ï¼Œæ¯ä¸ªå°ç‚¸å¼¹çš„ç¼–å·éƒ½ä¸º`phase_n`ï¼Œæ•…å¯ä»¥å¾ˆå¿«çš„å®šä½åˆ°é—®é¢˜æ‰€åœ¨ã€‚

åœ¨ä½¿ç”¨`gdb` çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸Š`-tui`å‘½ä»¤å¹¶ç”¨`layout asm`å‘½ä»¤åˆ‡æ¢åˆ°æ±‡ç¼–æŒ‡ä»¤æ¨¡å¼ï¼Œå°±å¯ä»¥åœ¨è°ƒè¯•çš„æ—¶å€™æŸ¥çœ‹å¯¹åº”çš„æ±‡ç¼–ä»£ç äº†ã€‚ç•Œé¢å¦‚ä¸‹ï¼š

![image-20210514194024589](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514194026.png)

ä¸€ç›´å‘ä¸‹æŸ¥çœ‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°Cæ–‡ä»¶ä¸­å‡ºç°çš„`initialize_bomb`å‡½æ•°ï¼Œç„¶åå°±åˆ°äº†`phase_1`å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹è¿™ä¸ªå‡½æ•°å°±æ˜¯åˆ¤æ–­æ˜¯å¦é€šè¿‡çš„æ ¸å¿ƒå‡½æ•°ã€‚

å¯ä»¥çœ‹åˆ°åœ°å€`0x80489e4`å°±æ˜¯`main`å‡½æ•°çš„åœ°å€ã€‚

è¿™æ—¶å€™å°±è¦ç”¨åˆ°`gdb`çš„æŒ‡ä»¤äº†ï¼Œåœ¨æ±‡ç¼–æ¨¡å¼ä¸‹çš„æŒ‡ä»¤ä¸æ™®é€šæ¨¡å¼æœ‰ä¸€äº›ä¸åŒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`ni`(`next instruction`)å’Œ`si`(`step into`)æ¥å®ç°æ™®é€šæ¨¡å¼ä¸‹çš„å•æ­¥å‘ä¸‹æ‰§è¡Œä¸æ­¥å…¥æ“ä½œã€‚

#### `main`ğŸ˜Š

`main` å‡½æ•°ä¸»è¦è¿›è¡Œäº†å‡½æ•°å‚æ•°çš„å‡†å¤‡å’Œè°ƒç”¨ï¼Œå¤§è‡´æ ¼å¼éƒ½å¦‚ä¸‹ï¼š

1. å‚æ•°å‡†å¤‡
2. å‡½æ•°è°ƒç”¨
3. è¿”å›å€¼åˆ¤å®š
4. é”™è¯¯å¤„ç†

å…¶ä¸­æ¯ä¸ªç³»ç»Ÿå‡½æ•°å’Œè‡ªè®¢çš„å‡½æ•°åé¢éƒ½æœ‰`<infomation>`è¿›è¡Œæ³¨è§£ï¼Œè®©ç†è§£å˜å¾—ç®€å•äº†å¾ˆå¤š

![image-20210514194646316](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514194646.png)

è¯ä¸å¤šè¯´ï¼Œç›´æ¥è¿›å…¥æ¯ä¸ªå…³å¡çš„è§£å†³ğŸ

#### `phase_1`ğŸ‘¨â€ğŸš€

å…³å¡çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹

```assembly
08048b50 <phase_1>:
 8048b50:	83 ec 1c             	sub    $0x1c,%esp
 8048b53:	c7 44 24 04 dc a1 04 	movl   $0x804a1dc,0x4(%esp)
 8048b5a:	08 
 8048b5b:	8b 44 24 20          	mov    0x20(%esp),%eax
 8048b5f:	89 04 24             	mov    %eax,(%esp)
 8048b62:	e8 ad 04 00 00       	call   8049014 <strings_not_equal>
 8048b67:	85 c0                	test   %eax,%eax
 8048b69:	74 05                	je     8048b70 <phase_1+0x20>
 8048b6b:	e8 b6 05 00 00       	call   8049126 <explode_bomb>
 8048b70:	83 c4 1c             	add    $0x1c,%esp
 8048b73:	c3                   	ret   
```

å¯ä»¥çœ‹è§ å…ˆå°†ä¸€ä¸ªåœ°å€ç»™äº†esp+4ï¼Œç„¶åè°ƒç”¨`<strings_not_equal>`è¿™ä¸ªå‡½æ•°ï¼Œä»åå­—å°±å¯ä»¥çŸ¥é“ï¼Œä»–æ˜¯åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œç„¶ååˆ¤æ–­`eax`çš„å€¼ï¼Œå¦‚æœæ˜¯0å°±è¿”å›ï¼Œä¸æ˜¯ç‚¸å¼¹å°±ä¼šçˆ†ç‚¸ï¼Œäºæ˜¯ä¹ï¼Œæˆ‘ä»¬é€‰æ‹©æŸ¥çœ‹`0x804a1dc`å¤„å­˜æ”¾çš„å€¼

![image-20210514195719613](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514195719.png)

æ˜¾è€Œæ˜“è§ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯æˆ‘ä»¬çš„ç­”æ¡ˆã€‚ğŸ˜

`For NASA, space is still a high priority`

![image-20210514195902124](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514195902.png)

#### `phase_2`ğŸ˜

ç»è¿‡ç¬¬ä¸€å…³çš„è€ƒéªŒï¼Œæˆ‘çŸ¥é“äº†éœ€è¦æ³¨æ„æ±‡ç¼–ä»£ç ä¸­çš„ç«‹å³æ•°å’Œè·³è½¬ï¼Œäºæ˜¯å¼€å§‹äº†ç¬¬äºŒå…³ï¼Œç¬¬äºŒå…³æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š

```assembly
08048b74 <phase_2>:
 8048b74:	56                   	push   %esi
 8048b75:	53                   	push   %ebx
 8048b76:	83 ec 34             	sub    $0x34,%esp
 8048b79:	8d 44 24 18          	lea    0x18(%esp),%eax
 8048b7d:	89 44 24 04          	mov    %eax,0x4(%esp)
 8048b81:	8b 44 24 40          	mov    0x40(%esp),%eax
 8048b85:	89 04 24             	mov    %eax,(%esp)
 8048b88:	e8 ce 06 00 00       	call   804925b <read_six_numbers>
 8048b8d:	83 7c 24 18 00       	cmpl   $0x0,0x18(%esp)
 8048b92:	75 07                	jne    8048b9b <phase_2+0x27>
 8048b94:	83 7c 24 1c 01       	cmpl   $0x1,0x1c(%esp)
 8048b99:	74 05                	je     8048ba0 <phase_2+0x2c>
 8048b9b:	e8 86 05 00 00       	call   8049126 <explode_bomb>
 8048ba0:	8d 5c 24 20          	lea    0x20(%esp),%ebx
 8048ba4:	8d 74 24 30          	lea    0x30(%esp),%esi
 8048ba8:	8b 43 f8             	mov    -0x8(%ebx),%eax
 8048bab:	03 43 fc             	add    -0x4(%ebx),%eax
 8048bae:	39 03                	cmp    %eax,(%ebx)
 8048bb0:	74 05                	je     8048bb7 <phase_2+0x43>
 8048bb2:	e8 6f 05 00 00       	call   8049126 <explode_bomb>
 8048bb7:	83 c3 04             	add    $0x4,%ebx
 8048bba:	39 f3                	cmp    %esi,%ebx
 8048bbc:	75 ea                	jne    8048ba8 <phase_2+0x34>
 8048bbe:	83 c4 34             	add    $0x34,%esp
 8048bc1:	5b                   	pop    %ebx
 8048bc2:	5e                   	pop    %esi
 8048bc3:	c3                   	ret    
```

æ ¹æ®è§‚å¯Ÿï¼Œè°ƒç”¨äº†å‡½æ•°`<read_six_numbers>`,è¾“å…¥äº†6ä¸ªæ•´æ•°ï¼Œéšå³åˆ¤æ–­ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ•°ä¸æ˜¯0ï¼Œå°†ä¼šçˆ†ç‚¸ï¼Œå¦‚æœæ˜¯ï¼Œåˆ¤æ–­ç¬¬äºŒä¸ªæ•°æ˜¯å¦ä¸º1ï¼Œå¦‚æœä¸æ˜¯ï¼Œä¹Ÿä¼šçˆ†ç‚¸ï¼Œéšåä¿å­˜`esp+0x20`å’Œ`esp+0x30`çš„ä¸¤ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥çš„ç¬¬3å’Œç¬¬6ä¸ªæ•°ï¼Œåˆ¤æ–­å¦‚æœç¬¬ä¸‰ä¸ªæ•°ç­‰äºæ±‡ç¼–ä¸­çš„å‰ä¸¤ä¸ªæ•°ä¹‹å’Œï¼Œåˆ™å°†`ebx+0x4`ä¹Ÿå°±æ˜¯å–ç¬¬å››ä¸ªæ•°ï¼Œåˆ¤æ–­æ˜¯å¦ç­‰äºç¬¬å…­ä¸ªæ•°ï¼Œä¸æ˜¯åˆ™è·³è½¬å›`0x8048ba8`é‡å¤æ‰§è¡Œï¼Œä¸éš¾çœ‹å‡ºï¼Œè¿™ä¸ªç¨‹åºçš„ç›®çš„æ˜¯æ±‚å‡ºæ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‰å…­é¡¹ï¼Œæ•…`0 1 1 2 3 5`ä¸ºç­”æ¡ˆã€‚ğŸ˜œ

![image-20210514201922436](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514201922.png)

#### `phase_3`ğŸ˜®

ç¬¬ä¸‰å…³çœ‹åˆ°æ±‡ç¼–ä»£ç ï¼Œå¾ˆæ˜æ˜¾çš„æœ‰ä¸€ä¸ªç‰¹å¾ï¼š

![image-20210514202040511](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514202040.png)

è¿™æ˜¯ä¸€ä¸ªè·³è½¬è¡¨ï¼Œé€šè¿‡å‰é¢çš„æ±‡ç¼–ä»£ç ï¼ŒæŸ¥çœ‹äº†`0x804a3cb`æ­¤å¤„çš„å€¼ï¼š

![image-20210514202231613](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514202231.png)

é€šè¿‡å‰åçš„ä»£ç å’Œç›¸å…³ä¿¡æ¯ä¸éš¾çœ‹å‡ºï¼Œè¿™æ˜¯`scanf(â€œ%d %dâ€)`çš„ä¸¤ä¸ªå½¢å‚ï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œè¿™é“é¢˜ç›®ï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥ä¸¤ä¸ªæ•´æ•°ã€‚

![image-20210514202444354](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514202444.png)

![image-20210514202509032](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514202509.png)

åŒæ—¶æ ¹æ®åé¢çš„çº¦æŸæ¡ä»¶å¯ä»¥çŸ¥é“ï¼Œè¾“å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼åº”è¯¥åœ¨`1~5`ä¹‹é—´ï¼Œè€Œåå‘ç°è·³è½¬è¡¨çš„è·³è½¬åœ°å€ä¼šæ ¹æ®è¾“å…¥çš„å€¼çš„å˜åŒ–è€Œå˜åŒ–ï¼Œæ•…çŒœæƒ³æœ¬é¢˜çš„ç­”æ¡ˆä¸æ­¢ä¸€ä¸ªï¼Œäºæ˜¯æ ¹æ®å‚æ•°è¦æ±‚ï¼Œå¯ä»¥å¾—åˆ°ç­”æ¡ˆï¼š

![image-20210514203714742](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514203714.png)

ç”±æ­¤å›¾å¯çŸ¥å½“è¾“å…¥ä¸º1æ—¶ï¼Œè·³è½¬è¡¨çš„çš„è·³è½¬åœ°å€ä¸º`0x8048c07`

å¯å¾—å…¶ä¸­çš„ä¸€ä¸ªç­”æ¡ˆä¸º:`1 -243`ã€‚ğŸµ

![image-20210514205103666](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514205103.png)

#### `phase_4`ğŸ˜‡

è¿™é“é¢˜ç›®æƒ³åšå‡ºæ¥ä¸æ˜¯å¾ˆéš¾ï¼Œä½†æ˜¯ä¸çŸ¥é“ä»–è¦å¹²ä»€ä¹ˆï¼Œæ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š

```assembly
08048ceb <phase_4>:
 8048ceb:	83 ec 2c             	sub    $0x2c,%esp
 8048cee:	8d 44 24 1c          	lea    0x1c(%esp),%eax
 8048cf2:	89 44 24 0c          	mov    %eax,0xc(%esp)
 8048cf6:	8d 44 24 18          	lea    0x18(%esp),%eax
 8048cfa:	89 44 24 08          	mov    %eax,0x8(%esp)
 8048cfe:	c7 44 24 04 cb a3 04 	movl   $0x804a3cb,0x4(%esp)
 8048d05:	08 
 8048d06:	8b 44 24 30          	mov    0x30(%esp),%eax
 8048d0a:	89 04 24             	mov    %eax,(%esp)
 8048d0d:	e8 5e fb ff ff       	call   8048870 <__isoc99_sscanf@plt>
 8048d12:	83 f8 02             	cmp    $0x2,%eax
 8048d15:	75 0d                	jne    8048d24 <phase_4+0x39>
 8048d17:	8b 44 24 18          	mov    0x18(%esp),%eax
 8048d1b:	85 c0                	test   %eax,%eax
 8048d1d:	78 05                	js     8048d24 <phase_4+0x39>
 8048d1f:	83 f8 0e             	cmp    $0xe,%eax
 8048d22:	7e 05                	jle    8048d29 <phase_4+0x3e>
 8048d24:	e8 fd 03 00 00       	call   8049126 <explode_bomb>
 8048d29:	c7 44 24 08 0e 00 00 	movl   $0xe,0x8(%esp)
 8048d30:	00 
 8048d31:	c7 44 24 04 00 00 00 	movl   $0x0,0x4(%esp)
 8048d38:	00 
 8048d39:	8b 44 24 18          	mov    0x18(%esp),%eax
 8048d3d:	89 04 24             	mov    %eax,(%esp)
 8048d40:	e8 3d ff ff ff       	call   8048c82 <func4>
 8048d45:	83 f8 0a             	cmp    $0xa,%eax
 8048d48:	75 07                	jne    8048d51 <phase_4+0x66>
 8048d4a:	83 7c 24 1c 0a       	cmpl   $0xa,0x1c(%esp)
 8048d4f:	74 05                	je     8048d56 <phase_4+0x6b>
 8048d51:	e8 d0 03 00 00       	call   8049126 <explode_bomb>
 8048d56:	83 c4 2c             	add    $0x2c,%esp
 8048d59:	c3                   	ret   
```

å¯ä»¥çœ‹åˆ°å…¶ä¸­è°ƒç”¨äº†`func_4`å‡½æ•°,ä¸”`func_4`çš„åä¸¤ä¸ªå‚æ•°å›ºå®šä¸º0å’Œ14ï¼Œä¸”ç¬¬ä¸€ä¸ªå‚æ•°ä¸º0å’Œ14ä¹‹é—´ï¼Œäºæ˜¯æŸ¥çœ‹`func_4`çš„æ±‡ç¼–ä»£ç ï¼Œå‘ç°ä»–æ˜¯ä¸ªé€’å½’å‡½æ•°ï¼š

```assembly
08048c82 <func4>:
 8048c82:	83 ec 1c             	sub    $0x1c,%esp
 8048c85:	89 5c 24 14          	mov    %ebx,0x14(%esp)
 8048c89:	89 74 24 18          	mov    %esi,0x18(%esp)
 8048c8d:	8b 44 24 20          	mov    0x20(%esp),%eax //c
 8048c91:	8b 54 24 24          	mov    0x24(%esp),%edx //b
 8048c95:	8b 74 24 28          	mov    0x28(%esp),%esi //a
 8048c99:	89 f1                	mov    %esi,%ecx
 8048c9b:	29 d1                	sub    %edx,%ecx //ecx=a-b
 8048c9d:	89 cb                	mov    %ecx,%ebx //ebx=a-b
 8048c9f:	c1 eb 1f             	shr    $0x1f,%ebx 
 8048ca2:	01 d9                	add    %ebx,%ecx 
 8048ca4:	d1 f9                	sar    %ecx //ecx/=2
 8048ca6:	8d 1c 11             	lea    (%ecx,%edx,1),%ebx
 8048ca9:	39 c3                	cmp    %eax,%ebx
 8048cab:	7e 17                	jle    8048cc4 <func4+0x42> 
 8048cad:	8d 4b ff             	lea    -0x1(%ebx),%ecx
 8048cb0:	89 4c 24 08          	mov    %ecx,0x8(%esp)
 8048cb4:	89 54 24 04          	mov    %edx,0x4(%esp)
 8048cb8:	89 04 24             	mov    %eax,(%esp)
 8048cbb:	e8 c2 ff ff ff       	call   8048c82 <func4>
 8048cc0:	01 c3                	add    %eax,%ebx
 8048cc2:	eb 19                	jmp    8048cdd <func4+0x5b>
 8048cc4:	39 c3                	cmp    %eax,%ebx
 8048cc6:	7d 15                	jge    8048cdd <func4+0x5b>
 8048cc8:	89 74 24 08          	mov    %esi,0x8(%esp)
 8048ccc:	8d 53 01             	lea    0x1(%ebx),%edx
 8048ccf:	89 54 24 04          	mov    %edx,0x4(%esp)
 8048cd3:	89 04 24             	mov    %eax,(%esp)
 8048cd6:	e8 a7 ff ff ff       	call   8048c82 <func4>
 8048cdb:	01 c3                	add    %eax,%ebx
 8048cdd:	89 d8                	mov    %ebx,%eax
 8048cdf:	8b 5c 24 14          	mov    0x14(%esp),%ebx
 8048ce3:	8b 74 24 18          	mov    0x18(%esp),%esi
 8048ce7:	83 c4 1c             	add    $0x1c,%esp
 8048cea:	c3   
```

æ ¹æ®æ±‡ç¼–ä»£ç ï¼Œå°†å…¶è½¬æˆCè¯­è¨€ä»£ç ï¼š

```C
int func_4(int c, int b, int a)
{
    int tmp1 = a - b;
    if (tmp1 < 0)
    {
        tmp1 += 1;
    }
    tmp1 = tmp1 / 2;
    int tmp2 = tmp1 + b;
    if (tmp2 > c)
    {
        int tmp3 = func_4(c, b, tmp2 - 1);
        tmp2 += tmp3;
        return tmp2;
    }
    else
    {
        if (tmp2 == c)
        {
            return tmp2;
        }
        int tmp3 = func_4(c, tmp2 + 1, a);
        tmp2 += tmp3;
        return tmp2;
    }
}
```

æ ¹æ®æ±‡ç¼–ä¸­çš„è¿”å›å€¼åˆ¤æ–­ï¼Œéœ€è¦è¿”å›å€¼ä¸º10

![image-20210514205010283](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514205010.png)

æ•…å¯ä»¥å¾—å‡ºï¼Œæ­¤é¢˜ç­”æ¡ˆä¸º`3  10`   ğŸ˜­

![image-20210514205121583](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514205121.png)

#### `phase_5`ğŸ¤¯

ç¬¬äº”é¢˜çš„é‡ç‚¹ä»£ç ï¼š

```assembly
 8048d80:	b8 00 00 00 00       	mov    $0x0,%eax
 8048d85:	0f be 14 03          	movsbl (%ebx,%eax,1),%edx     //edx=ebx+n*eax æŒ‰ç…§ç¬¦å·ä½æ‰©å±•åæ”¾å…¥edx
 8048d89:	83 e2 0f             	and    $0xf,%edx
 8048d8c:	0f b6 92 58 a2 04 08 	movzbl 0x804a258(%edx),%edx
 8048d93:	88 54 04 15          	mov    %dl,0x15(%esp,%eax,1) //å°†edxçš„ä½å…«ä½æ”¾å…¥å…¶ä¸­
 8048d97:	83 c0 01             	add    $0x1,%eax
 8048d9a:	83 f8 06             	cmp    $0x6,%eax //åˆ¤æ–­æ˜¯å¦ç­‰äº6 ç­‰äºå°±ç»“æŸå¾ªç¯
 8048d9d:	75 e6                	jne    8048d85 <phase_5+0x2b>
```

æ ¹æ®ä¸‹é¢çš„ä»£ç ï¼Œæ€»ç®—çœ‹åˆ°äº†å¸Œæœ›ğŸ¤•ï¼š

```assembly
 8048d9f:	c6 44 24 1b 00       	movb   $0x0,0x1b(%esp)
 8048da4:	c7 44 24 04 2e a2 04 	movl   $0x804a22e,0x4(%esp)
 8048dab:	08 
 8048dac:	8d 44 24 15          	lea    0x15(%esp),%eax
 8048db0:	89 04 24             	mov    %eax,(%esp)
 8048db3:	e8 5c 02 00 00       	call   8049014 <strings_not_equal>
 8048db8:	85 c0                	test   %eax,%eax
 8048dba:	74 05                	je     8048dc1 <phase_5+0x67>
```

æ­¤å¤„è°ƒç”¨äº†å‡½æ•°`<strings_not_equal>`ï¼Œæ•…å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç›®æ ‡å­—ç¬¦ä¸²ï¼š

![image-20210514210029363](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514210029.png)

å†åˆ†æä¸Šé¢çš„ä»£ç ï¼ŒåŸæ¥åœ¨è¿™é‡Œ`eax`èµ·åˆ°çš„æ˜¯ä¸€ä¸ªç´¢å¼•çš„ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå¯ä»¥çŸ¥é“æºå¤´æ¥è‡ª

![image-20210514210245945](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514210245.png)

æ‰€ä»¥ï¼Œæ ¹æ®ç›®æ ‡å­—ç¬¦ä¸²`flyers`çš„ç´¢å¼•åˆ†åˆ«ä¸º`9 15 14 5 6 7`ã€‚è¿™ä¸ªç´¢å¼•å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦çš„ä½4ä½ï¼Œé‚£æˆ‘ä»¬åªè¦æ‰¾åˆ°ä½4ä½åˆ†åˆ«æ˜¯ä»¥ä¸Šæ•°å€¼çš„å­—ç¬¦å°±å¯ä»¥äº†ã€‚æ‰€ä»¥é˜¶æ®µ5çš„ï¼ˆä¸€ä¸ªï¼‰ç­”æ¡ˆä¸ºğŸ¥³ï¼š

```text
ionefg
```

![image-20210514210843451](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514210843.png)

#### `phase_6`â˜ 

è¶Šåˆ°åé¢è¶Šèƒ½æ„Ÿå—åˆ°é¢˜ç›®çš„å‡¶æ®‹ï¼Œç¬¬å…­é¢˜ä¹Ÿè®©æˆ‘éš¾å—åˆ°äº†æç‚¹ï¼Œå…ˆè¯»å…¥6ä¸ªæ•°å­—ï¼Œç„¶åéƒ¨åˆ†æ±‡ç¼–ä»£ç å¦‚ä¸‹ğŸ¥ºï¼š

```assembly
 8048df5:	be 00 00 00 00       	mov    $0x0,%esi
 8048dfa:	8b 44 b4 10          	mov    0x10(%esp,%esi,4),%eax
 8048dfe:	83 e8 01             	sub    $0x1,%eax
 8048e01:	83 f8 05             	cmp    $0x5,%eax
 8048e04:	76 05                	jbe    8048e0b <phase_6+0x2f>
 8048e06:	e8 1b 03 00 00       	call   8049126 <explode_bomb>
 8048e0b:	83 c6 01             	add    $0x1,%esi
 8048e0e:	83 fe 06             	cmp    $0x6,%esi
 8048e11:	74 33                	je     8048e46 <phase_6+0x6a>
 8048e13:	89 f3                	mov    %esi,%ebx
 8048e15:	8b 44 9c 10          	mov    0x10(%esp,%ebx,4),%eax
 8048e19:	39 44 b4 0c          	cmp    %eax,0xc(%esp,%esi,4)
 8048e1d:	75 05                	jne    8048e24 <phase_6+0x48>
 8048e1f:	e8 02 03 00 00       	call   8049126 <explode_bomb>
 8048e24:	83 c3 01             	add    $0x1,%ebx
 8048e27:	83 fb 05             	cmp    $0x5,%ebx
 8048e2a:	7e e9                	jle    8048e15 <phase_6+0x39>
 8048e2c:	eb cc                	jmp    8048dfa <phase_6+0x1e>
 8048e2e:	8b 52 08             	mov    0x8(%edx),%edx
```

å‰é¢æ˜¯ä¸€ç³»åˆ—çš„èµ‹å€¼æ“ä½œï¼Œç¬¬3è¡Œå°†`eax`å‡1ï¼Œ`eax`ä¸­çš„å€¼æ˜¯`esp+50`ä½ç½®å­˜æ”¾çš„å€¼ã€‚ç¬¬3ã€4ä¸¤è¡Œå°†å‡ä¸€ä»¥åçš„å€¼ä¸5è¿›è¡Œæ¯”è¾ƒï¼Œå°äºç­‰äº5åˆ™è·³è¿‡å¼•çˆ†ä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´`eax`ä¸­å­˜æ”¾çš„ç¬¬ä¸€ä¸ªæ•°å¿…é¡»å°äºç­‰äº6.

ä¹‹å‰å°†`esi`ç½®ä¸º0ï¼Œç¬¬7è¡Œä¸­å°†`esi`çš„å€¼å¢åŠ 1ï¼Œä¸‹ä¸€è¡Œä¸6è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰åˆ™è·³å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚

ç¬¬10è¡Œä¸­æŠŠ`esi`ä¸­çš„å€¼å¤åˆ¶ç»™äº†`ebx`ï¼Œä¸‹ä¸€æ­¥åˆèµ‹ç»™äº†`eax`ï¼Œæ¥ä¸‹æ¥çš„ä¸€è¡Œ`mov`å°†`esp+eax*4`ä¸­çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯ç¬¬`eax+1`ä¸ªè¯»å…¥çš„`int`å€¼ï¼‰ç»™äº†`eax`ã€‚

ä¸‹ä¸€æ­¥å°†`eax`ä¸­çš„å€¼ä¸`ebp`åœ°å€æŒ‡å‘çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸ç›¸åŒåˆ™è·³è¿‡å¼•çˆ†ä»£ç ã€‚è¯´æ˜è¿™ä¸¤ä¸ªå€¼éœ€è¦ä¸åŒï¼Œå†æ¥ä¸‹æ¥å°†`ebx`ä¸­çš„å€¼åŠ 1ï¼Œå†ä¸5è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå°äºç­‰äº5åˆ™è·³åˆ°ç¬¬13è¡Œä¸­ï¼Œæ›´æ–°`eax`çš„å€¼ï¼Œå†å»ä»æ ˆä¸­å–ä¸‹ä¸€ä¸ªæ–°çš„`int`å€¼å’Œ`ebp`ä¸­çš„è¿›è¡Œæ¯”è¾ƒã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä»13è¡Œåˆ°20è¡Œç›¸å½“äºä¸€ä¸ªå†…å¾ªç¯ï¼Œä»`esi`å¼€å§‹ï¼Œåˆ°5ç»“æŸï¼Œä¸æ–­åœ°å–æ ˆä¸­çš„å€¼ä¸`ebp`çš„å€¼æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯è¦æ±‚`ebp`ä¹‹åçš„å€¼éœ€è¦ä¸`ebp`ä¸åŒã€‚

ç¬¬17ã€18è¡Œåˆ™æ˜¯å¤–å¾ªç¯ï¼Œå®ƒæ›´æ–°äº†`eax`çš„å€¼ï¼Œä»¤`eax`æŒ‡å‘ä¸‹ä¸€ä¸ª`int`å€¼ã€‚è·³åˆ°ç¬¬3è¡Œç”¨`eax`çš„å€¼æ›´æ–°`ebp`çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æŠŠæ¯”è¾ƒçš„å¯¹è±¡å‘åç§»ä¸€ä¸ªã€‚åŒæ ·è¦æ±‚è¯¥å€¼å°äºç­‰äº5ã€‚åé¢å†è¿›è¡Œå†…å¾ªç¯æ¯”è¾ƒä¹‹åçš„å€¼ã€‚

å¯ä»¥æ˜ç™½è¿™æ®µä»£ç çš„ä½œç”¨ï¼šé™åˆ¶è¯»å…¥çš„6ä¸ªæ•°å¿…é¡»å°äºç­‰äº6å¹¶ä¸”äº’ä¸ç›¸ç­‰

åé¢çš„ä»£ç åŸºæœ¬å°±çœ‹ä¸æ‡‚äº†ğŸ’”ï¼Œä½†æ˜¯ï¼Œè¿™ä¸²ä»£ç ä¸ºè§£å†³è¿™é“é¢˜åŸ‹ä¸‹äº†ä¼ç¬”ğŸ˜ŠğŸ˜™ï¼š

```assembly
 8048e4d:	8b 4c 9c 10          	mov    0x10(%esp,%ebx,4),%ecx
 8048e51:	b8 01 00 00 00       	mov    $0x1,%eax
 8048e56:	ba 3c c1 04 08       	mov    $0x804c13c,%edx
 8048e5b:	83 f9 01             	cmp    $0x1,%ecx
 8048e5e:	7f ce                	jg     8048e2e <phase_6+0x52>
```

æˆ‘ä»¬æŸ¥çœ‹è¿è¡Œæ—¶å†…å­˜å¯çŸ¥ï¼š

![image-20210514213041742](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514213041.png)

é€šè¿‡åç§°ä¸éš¾å‘ç°è¿™æ˜¯ä¸€ä¸²é“¾è¡¨ï¼Œäºæ˜¯ï¼Œè§‚å¯Ÿåé¢å¯çŸ¥ğŸ¤©

```assembly
 8048e89:	c7 40 08 00 00 00 00 	movl   $0x0,0x8(%eax)
 8048e90:	be 05 00 00 00       	mov    $0x5,%esi
 8048e95:	8b 43 08             	mov    0x8(%ebx),%eax// node=node->next
 8048e98:	8b 10                	mov    (%eax),%edx
 8048e9a:	39 13                	cmp    %edx,(%ebx)
 8048e9c:	7d 05                	jge    8048ea3 <phase_6+0xc7>
 8048e9e:	e8 83 02 00 00       	call   8049126 <explode_bomb>
 8048ea3:	8b 5b 08             	mov    0x8(%ebx),%ebx
 8048ea6:	83 ee 01             	sub    $0x1,%esi
 8048ea9:	75 ea                	jne    8048e95 <phase_6+0xb9>
 8048eab:	83 c4 44             	add    $0x44,%esp
 8048eae:	5b                   	pop    %ebx
 8048eaf:	5e                   	pop    %esi
 8048eb0:	c3                   	ret    
```

ä»–åœ¨è¿›è¡Œå¾ªç¯ï¼Œæ£€æŸ¥è¾“å…¥çš„åºåˆ—ï¼Œå¦‚æœå‘ç°å‰é¢ç¼–å·èŠ‚ç‚¹çš„å€¼å¤§äºåé¢ç¼–å·èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™ç»§ç»­ï¼Œå¦åˆ™çˆ†ç‚¸ï¼ŒåŒæ—¶å½“åºåˆ—æ£€æŸ¥å®Œæˆï¼Œè¿”å›ï¼Œæ‰€ä»¥å¯ä»¥å¤§è‡´çŒœæƒ³è¿™ä¸ªå°é¢˜çš„ä½œç”¨æ˜¯è¾“å…¥ä¸€ä¸ªåºåˆ—ï¼Œä¿è¯è¾“å…¥åºåˆ—æ‰€ä»£è¡¨çš„èŠ‚ç‚¹æ•°æ®å‡åºæ’åˆ—ï¼Œäºæ˜¯å¼€å§‹éªŒè¯ï¼Œå…ˆæ‰“å°æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ğŸ§ğŸ˜…ï¼š

![image-20210514214945447](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514214945.png)

æ ¹æ®èŠ‚ç‚¹å€¼æ’åºåºåˆ—ä¸ºï¼š

`1 2 4 5 6 3`

éªŒè¯å¾—ğŸ¤—ï¼š

![image-20210514215334612](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514215334.png)

æˆåŠŸå®ŒæˆğŸ¤’ğŸ¤®ã€‚

#### `secret_phase`ğŸ˜±

```assembly
08048f02 <secret_phase>:
 8048f02:	53                   	push   %ebx
 8048f03:	83 ec 18             	sub    $0x18,%esp
 8048f06:	e8 42 02 00 00       	call   804914d <read_line>
 8048f0b:	c7 44 24 08 0a 00 00 	movl   $0xa,0x8(%esp)
 8048f12:	00 
 8048f13:	c7 44 24 04 00 00 00 	movl   $0x0,0x4(%esp)
 8048f1a:	00 
 8048f1b:	89 04 24             	mov    %eax,(%esp)
 8048f1e:	e8 bd f9 ff ff       	call   80488e0 <strtol@plt>
 8048f23:	89 c3                	mov    %eax,%ebx
 8048f25:	8d 40 ff             	lea    -0x1(%eax),%eax
 8048f28:	3d e8 03 00 00       	cmp    $0x3e8,%eax
 8048f2d:	76 05                	jbe    8048f34 <secret_phase+0x32>
 8048f2f:	e8 f2 01 00 00       	call   8049126 <explode_bomb>
 8048f34:	89 5c 24 04          	mov    %ebx,0x4(%esp) 
 8048f38:	c7 04 24 88 c0 04 08 	movl   $0x804c088,(%esp) //36
 8048f3f:	e8 6d ff ff ff       	call   8048eb1 <fun7>
 8048f44:	83 f8 04             	cmp    $0x4,%eax
 8048f47:	74 05                	je     8048f4e <secret_phase+0x4c>
 8048f49:	e8 d8 01 00 00       	call   8049126 <explode_bomb>
 8048f4e:	c7 04 24 08 a2 04 08 	movl   $0x804a208,(%esp) //win
 8048f55:	e8 a6 f8 ff ff       	call   8048800 <puts@plt>
 8048f5a:	e8 4c 03 00 00       	call   80492ab <phase_defused>
 8048f5f:	83 c4 18             	add    $0x18,%esp
 8048f62:	5b                   	pop    %ebx
 8048f63:	c3                   	ret 
```

é€šè¿‡æŸ¥çœ‹æ±‡ç¼–ä»£ç ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“æ€ä¹ˆè¿›å…¥ç§˜å¯†å…³å¡ï¼Œä½†æ˜¯ä¸Šé¢çš„æ±‡ç¼–ä»£ç å¹¶æ²¡æœ‰æç¤ºï¼Œè¿™é‡Œå¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥åœ¨åæ±‡ç¼–ä»£ç ä¸­æœç´¢`secret_phase`çš„å…¥å£åœ°å€ï¼Œå¾ˆå¿«å°±å¯ä»¥å‘ç°åœ¨æ¯ä¸ªé˜¶æ®µçš„`phase_x`ä¹‹åéƒ½æœ‰ä¸€è¡Œ`phase_defused`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å§‹åˆ†ææ­¤å‡½æ•°ï¼š

```assembly
080492ab <phase_defused>:
 80492ab:	81 ec 8c 00 00 00    	sub    $0x8c,%esp
 80492b1:	65 a1 14 00 00 00    	mov    %gs:0x14,%eax
 80492b7:	89 44 24 7c          	mov    %eax,0x7c(%esp)
 80492bb:	31 c0                	xor    %eax,%eax
 80492bd:	83 3d cc c3 04 08 06 	cmpl   $0x6,0x804c3cc
 80492c4:	75 72                	jne    8049338 <phase_defused+0x8d>
 80492c6:	8d 44 24 2c          	lea    0x2c(%esp),%eax
 80492ca:	89 44 24 10          	mov    %eax,0x10(%esp)
 80492ce:	8d 44 24 28          	lea    0x28(%esp),%eax
 80492d2:	89 44 24 0c          	mov    %eax,0xc(%esp)
 80492d6:	8d 44 24 24          	lea    0x24(%esp),%eax
 80492da:	89 44 24 08          	mov    %eax,0x8(%esp)
 80492de:	c7 44 24 04 d1 a3 04 	movl   $0x804a3d1,0x4(%esp)
 80492e5:	08 
 80492e6:	c7 04 24 d0 c4 04 08 	movl   $0x804c4d0,(%esp)
 80492ed:	e8 7e f5 ff ff       	call   8048870 <__isoc99_sscanf@plt>
 80492f2:	83 f8 03             	cmp    $0x3,%eax
 80492f5:	75 35                	jne    804932c <phase_defused+0x81>
 80492f7:	c7 44 24 04 da a3 04 	movl   $0x804a3da,0x4(%esp)
 80492fe:	08 
 80492ff:	8d 44 24 2c          	lea    0x2c(%esp),%eax
 8049303:	89 04 24             	mov    %eax,(%esp)
 8049306:	e8 09 fd ff ff       	call   8049014 <strings_not_equal>
 804930b:	85 c0                	test   %eax,%eax
 804930d:	75 1d                	jne    804932c <phase_defused+0x81>
 804930f:	c7 04 24 a0 a2 04 08 	movl   $0x804a2a0,(%esp)
 8049316:	e8 e5 f4 ff ff       	call   8048800 <puts@plt>
 804931b:	c7 04 24 c8 a2 04 08 	movl   $0x804a2c8,(%esp)
 8049322:	e8 d9 f4 ff ff       	call   8048800 <puts@plt>
 8049327:	e8 d6 fb ff ff       	call   8048f02 <secret_phase>
 804932c:	c7 04 24 00 a3 04 08 	movl   $0x804a300,(%esp)
 8049333:	e8 c8 f4 ff ff       	call   8048800 <puts@plt>
 8049338:	8b 44 24 7c          	mov    0x7c(%esp),%eax
 804933c:	65 33 05 14 00 00 00 	xor    %gs:0x14,%eax
 8049343:	74 05                	je     804934a <phase_defused+0x9f>
 8049345:	e8 86 f4 ff ff       	call   80487d0 <__stack_chk_fail@plt>
 804934a:	81 c4 8c 00 00 00    	add    $0x8c,%esp
 8049350:	c3                   	ret    
```

é€šè¿‡æŸ¥çœ‹å…¶ä¸­å‡ ä¸ªç«‹å³æ•°çš„å€¼ï¼Œå¯ä»¥å‘ç°ï¼š

![image-20210514220405348](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514220405.png)

è¾“å…¥çš„`sscanf`å‡½æ•°åœ¨è¾“å…¥ä¸¤ä¸ªæ•´æ•°æ—¶ï¼Œåœ¨åé¢åŠ ä¸Šä¸€ä¸ªå­—ç¬¦ä¸²å°±å¯è¿›å…¥ç§˜å¯†å…³å¡ï¼Œæ ¹æ®ä¹‹å‰çš„ç ´è§£ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å‘ç°ï¼Œåªæœ‰ç¬¬ä¸‰å…³å’Œç¬¬å››å…³è¾“å…¥çš„æ˜¯ä¸¤ä¸ªæ•´æ•°ï¼Œäºæ˜¯ï¼Œå°è¯•ä¸€ä¸‹ğŸ˜‘ğŸ˜¥ï¼š

![image-20210514220704370](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514220704.png)

![image-20210514220711310](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514220711.png)

å¯ä»¥å‘ç°ï¼Œç¬¬å››å…³çš„ç­”æ¡ˆåè¾“å…¥`DrEvil ` å³å¯åœ¨æœ€åè¿›å…¥éšè—å…³å¡ï¼Œéšåé€šè¿‡æ±‡ç¼–ä»£ç ï¼Œå‘ç°åªéœ€è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼Œä½¿å¾—`func7`å‡½æ•°çš„è¿”å›å€¼æ˜¯4ï¼Œäºæ˜¯å¼€å§‹åˆ†æ`func7`å‡½æ•°ğŸ™€ï¼š

```assembly
08048eb1 <fun7>:
 8048eb1:	53                   	push   %ebx
 8048eb2:	83 ec 18             	sub    $0x18,%esp
 8048eb5:	8b 54 24 20          	mov    0x20(%esp),%edx
 8048eb9:	8b 4c 24 24          	mov    0x24(%esp),%ecx
 8048ebd:	85 d2                	test   %edx,%edx
 8048ebf:	74 37                	je     8048ef8 <fun7+0x47>
 8048ec1:	8b 1a                	mov    (%edx),%ebx
 8048ec3:	39 cb                	cmp    %ecx,%ebx
 8048ec5:	7e 13                	jle    8048eda <fun7+0x29>
 8048ec7:	89 4c 24 04          	mov    %ecx,0x4(%esp)
 8048ecb:	8b 42 04             	mov    0x4(%edx),%eax
 8048ece:	89 04 24             	mov    %eax,(%esp)
 8048ed1:	e8 db ff ff ff       	call   8048eb1 <fun7>
 8048ed6:	01 c0                	add    %eax,%eax
 8048ed8:	eb 23                	jmp    8048efd <fun7+0x4c>
 8048eda:	b8 00 00 00 00       	mov    $0x0,%eax
 8048edf:	39 cb                	cmp    %ecx,%ebx
 8048ee1:	74 1a                	je     8048efd <fun7+0x4c>
 8048ee3:	89 4c 24 04          	mov    %ecx,0x4(%esp)
 8048ee7:	8b 42 08             	mov    0x8(%ed  x),%eax
 8048eea:	89 04 24             	mov    %eax,(%esp)
 8048eed:	e8 bf ff ff ff       	call   8048eb1 <fun7>
 8048ef2:	8d 44 00 01          	lea    0x1(%eax,%eax,1),%eax
 8048ef6:	eb 05                	jmp    8048efd <fun7+0x4c>
 8048ef8:	b8 ff ff ff ff       	mov    $0xffffffff,%eax
 8048efd:	83 c4 18             	add    $0x18,%esp
 8048f00:	5b                   	pop    %ebx
 8048f01:	c3 
```

ç”±äºä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªåœ°å€ï¼Œäºæ˜¯æˆ‘ä»¬æŸ¥çœ‹è¯¥åœ°å€çš„å€¼ï¼š

![image-20210514221309347](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514221309.png)

å¯ä»¥çœ‹åˆ°ï¼Œè¿™å’Œä¹‹å‰çš„å¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯è¿™æ¬¡çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œäºæ˜¯æŸ¥çœ‹æ›´å¤šä¿¡æ¯ğŸ˜ªğŸ˜¯ï¼š

![image-20210514221627816](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514221627.png)

ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°è¿™æ˜¯ä¸€ä¸ªäºŒå‰æ ‘çš„ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç¬¬1ä¸ª8å­—èŠ‚å­˜æ”¾æ•°æ®ï¼Œç¬¬2ä¸ª8å­—èŠ‚å­˜æ”¾å·¦å­æ ‘åœ°å€ï¼Œç¬¬3ä¸ª8å­—èŠ‚å­˜æ”¾å³å­æ ‘ä½ç½®ã€‚å¹¶ä¸”å‘½ä»¤ä¹Ÿæœ‰è§„å¾‹ï¼Œ`nab`ï¼Œ`a`ä»£è¡¨å±‚æ•°ï¼Œ`b`ä»£è¡¨ä»å·¦è‡³å³ç¬¬bä¸ªèŠ‚ç‚¹ï¼Œäºæ˜¯å¯ä»¥å¾—åˆ°ä¸‹å›¾ğŸ¤“ï¼š

![img](https://gitee.com/Monkeyman520/MonkeyImgURL/raw/master/img/20210514221819.png)

æ€»ç»“ä¸Šé¢çš„è¿‡ç¨‹ï¼š`ebx`æŒ‡å‘ä¸€ä¸ªæ ‘çš„èŠ‚ç‚¹ï¼Œä»¤`ebx`èŠ‚ç‚¹çš„å€¼ä¸æˆ‘ä»¬è¯»å…¥çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚ğŸ§ğŸ§

- å¦‚æœä¸¤è€…ç›¸ç­‰ï¼šè¿”å›0
- å¦‚æœå‰è€…å¤§äºåè€…ï¼š`ebx`ç§»è‡³å·¦å­æ ‘ï¼Œè¿”å›`2 * eax`
- å¦‚æœåè€…å¤§äºå‰è€…ï¼š`ebx`ç§»è‡³å³å­æ ‘ï¼Œè¿”å›`2 * eax + 1`

æƒ³è¦è¿”å›4ï¼Œåˆ™è¿”å›çš„é€†åºåˆ—æ˜¯`0 1 2 4` 

è¿”å›æ¡ä»¶ï¼šå·¦ å·¦ å³

ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼ŒæŒ‰ç…§è¿”å›æ¡ä»¶å¯å¾—ï¼šç¬¦åˆé¢˜æ„å¾—ç­”æ¡ˆæ˜¯`7`ã€‚ğŸ•ğŸ•ğŸ•

## æ€»ç»“ğŸ˜

è‡³æ­¤ï¼Œæœ¬æ¬¡å®éªŒå°±ç¨€é‡Œç³Šæ¶‚å¾—å®Œæˆäº†ï¼Œè™½ç„¶è¿˜æ˜¯æœ‰äº›ä¸æ˜ç™½ï¼Œä½†æ˜¯éƒ½æ˜¯è‡ªå·±è®¤çœŸæ€è€ƒå¾—å‡ºçš„è§£å†³æ–¹æ¡ˆï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šä¸å®Œå–„å¾—åœ°æ–¹ï¼Œè·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼ŒçœŸéš¾å•Šï¼Œä½†æ˜¯æ”¶è·ä¹Ÿå¾ˆå¤§ï¼Œå­¦ä¼šäº†å¥½å¤šä¸œè¥¿ï¼Œçœ‹æ±‡ç¼–å¾—èƒ½åŠ›ä¹Ÿæå‡äº†ä¸å°‘ï¼Œä½†æ˜¯è¿˜ä¸å¤Ÿï¼Œéœ€è¦ç»§ç»­åŠªåŠ›ï¼ğŸ›«